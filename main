import os
from typing import Union, Any, List, Generator
import nltk
from wfw import sentiment_scores
from nltk.sentiment.vader import SentimentIntensityAnalyzer
import openai
from random import choice
import time

from openai.openai_object import OpenAIObject
openai.api_key = 'abc'
OPENAI_KEY = os.environ.get("openai.api_key")

cwaize=int(input("Choose your character anon: 1) Hufflepuff,2)Slytherin,3) Gryffindor"))
if cwaize==3:
    prompt_text = "This is the first day in Hogwarts. Your scar still burns. Reminds you of the pain you suffered at the hands of the evil lord Voldemort. But that's past you now as you face the sorting hat in the main hall. Gryyfindor! the sorting hat shouts as soon he sees you."
elif cwaize==2:
    prompt_text="This is the first day in Hogwarts. Your scar still burns. Reminds you of the pain you suffered at the hands of the evil lord Voldemort. But that's past you now as you face the sorting hat in the main hall. Slytherin! the sorting hat shouts as soon he sees you."
elif cwaize==1:
    prompt_text="This is the first day in Hogwarts. Your scar still burns. Reminds you of the pain you suffered at the hands of the evil lord Voldemort. But that's past you now as you face the sorting hat in the main hall. Hufflepuff! the sorting hat shouts as soon he sees you."
from playsound import playsound

import re

def colored(r, g, b, text):
    return "\033[38;2;{};{};{}m{} \033[38;2;255;255;255m".format(r, g, b, text)

    #print(colored(255, 0, 0, 'Hello, World'))


import requests                                  
def imgto(texxt):
    r = requests.post(
    "https://api.deepai.org/api/text2img",
    data={
        'text': texxt,
    },
    headers={'api-key': 'bf773026-51e9-4cd5-aa54-427cb2cadc70'}
)
    print(r.json())

def qust(x):
  response = openai.Completion.create(
     engine="davinci",
       prompt=prompt_text,
        temperature=0.4,
         max_tokens=64,
   frequency_penalty=0.4,
   presence_penalty=0.4,
      )
  print("=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-")
  sentiment_scores(response['choices'][0]['text'])
  print("=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-")
  #playsound("C:\\Users\\User\PycharmProjects\miniprojectafterreport\Dark Souls Parry (With sound effect).wav")



  for x in range(3):

    response2 = openai.Completion.create(
      engine="davinci",
      prompt=prompt_text + response['choices'][0]['text'],
      temperature=0.6,
      max_tokens=64,
frequency_penalty=0.7,
  presence_penalty=0.7,
      # use this for last line instead of this method in main.
    )
    response3 = openai.Completion.create(
      engine="davinci",
      prompt=prompt_text + response['choices'][0]['text'],
      temperature=0.6,
      max_tokens=64,
      frequency_penalty=0.7,
      presence_penalty=0.7,
    )

    chime=int(input( "Choices!!!:---->" +"=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n"+ colored(255,255,0,response2['choices'][0]['text'])+"\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=" + "\nOR WOULD YOU RATHER GO DOWN THIS PATH? \n-->"+"=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=\n" +colored(0,255,127,response3['choices'][0]['text'])+"\n=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-="))

    #print("1                           OR                             2")
    if chime==1:
      response = openai.Completion.create(
        engine="text-davinci-002",
        prompt=response['choices'][0]['text'] + response2['choices'][0]['text'],
        temperature=0.3,
        max_tokens=64,
frequency_penalty=1,
  presence_penalty=1,
      )


    #  print("         1        /\n       /\n      /\n     /\n    /\n   /\n  /\n /\n|\n↓")
      print(colored(255,0,0,response2['choices'][0]['text']+response['choices'][0]['text']))
      with open('bluuudborne8.txt','a') as f:
          f.writelines(response['choices'][0]['text'])

    elif chime==2:

      response = openai.Completion.create(
        engine="text-davinci-002",
        prompt=response['choices'][0]['text']+ response3['choices'][0]['text'],
        temperature=0.3,
        max_tokens=64,
frequency_penalty=1,
  presence_penalty=1,
      )

     # print("       2        \ \n         \ \n          \ \n           \ \n            \ \n             \ \n              |\n              ↓")
      print(colored(255,0,0,response3['choices'][0]['text']+response['choices'][0]['text']))
      with open('bluuudborne8.txt','a') as f:
          f.writelines(response['choices'][0]['text'])

qust(0)

def end():
    filez=open("bluuudborne8.txt","r")
    data=filez.read()
    responseemotion= openai.Completion.create(
        engine="text-davinci-002",
        prompt=("The following will analyze the overall tone of the story and output either 'good' or 'bad'. If the player chose good moral decisions, the ending will be good ending or else bad ending:\n\n" + data ),
        temperature=0,
        max_tokens=32,
        top_p=1.0,
        frequency_penalty=1,
        presence_penalty=1
    )

    if responseemotion=="good":
        response55 = openai.Completion.create(
        engine="text-davinci-002",
        prompt=(data+"\n"+"You must find the dark lord Voldemort and must kill him.\nConclude this story:\n"),
        temperature=0.4,
        max_tokens=128,
        top_p=1.0,
        frequency_penalty=1,
        presence_penalty=1
    )
        print("Yor story concludes:" + response55['choices'][0]['text'])
    else:
        response65=openai.Completion.create(
        engine="text-davinci-002",
        prompt=(data+"\n"+"The dark lord finds you and tries to kill you.\nConclude this story:\n"),
        temperature=0.4,
        max_tokens=128,
        top_p=1.0,
        frequency_penalty=0.5,
        presence_penalty=0.5
    )
        print("Yor story concludes:" + response65['choices'][0]['text'])
        filez.close()
        imgto(data.split(".")[-1])

end()
print("Do you wish to restart your journey??1,any other key")
noi=int(input)
if noi==1:
    qust(0)
else:
    print("*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-")


#prompt33 = "Alas the story has to conclude. You were either successful in eradicating the beastly scurge or died trying"

